# План разработки улучшений David Manager

## 1. UI/UX Улучшения

### 1.1 Loader в стиле iOS 26
- Создать компонент `PageLoader` с анимацией в стиле iOS
- Интегрировать в роутинг для показа при переходах
- Использовать blur эффекты и плавные переходы

### 1.2 Улучшение стилей
- Обновить цветовую палитру
- Улучшить spacing и typography
- Добавить больше glassmorphism эффектов
- Улучшить анимации и transitions
- Оптимизировать для мобильных устройств

## 2. Система настроек

### 2.1 Модель Settings (Backend)
```typescript
- theme: 'light' | 'dark' | 'auto'
- darkModeStart: string (HH:mm МСК)
- darkModeEnd: string (HH:mm МСК)
- primaryColor: string
- accentColor: string
```

### 2.2 Страница Settings (Frontend)
- Настройка темы (светлая/тёмная/авто)
- Настройка времени ночного режима
- Выбор цветовой схемы
- Предпросмотр изменений

## 3. Интеграция с Telegram API

### 3.1 Модель TelegramConfig (Backend)
```typescript
- botToken: string
- chatId: string (основной чат)
- topics: {
    invoices: string (topic ID)
    pickingLists: string
    balance: string
    payments: string
    users: string
  }
- enabled: boolean
```

### 3.2 Сервис Telegram Notifications
- Функция отправки сообщений в топики
- Обработка ошибок
- Логирование

### 3.3 Типы уведомлений

#### 3.3.1 Уведомления о накладных
- Создание накладной: "Сотрудник {name} добавил накладную поставщика {supplier}"
- Прикрепление фото накладной
- Топик: invoices

#### 3.3.2 Уведомления о листе сборки
- Товар собран: "Сотрудник {name} отметил что товар {item} собран"
- Товар не собран: "Сотрудник {name} отметил что товар {item} не собран"
- Импорт Excel: "Импортировано {count} товаров в лист сборки"
- Топик: pickingLists

#### 3.3.3 Уведомления о балансе поставщика
- Изменение баланса: "Баланс поставщика {supplier} изменился на {amount} ₽. Новый баланс: {balance} ₽"
- Оплата накладных: "Оплачено накладных на сумму {amount} ₽ поставщику {supplier}"
- Топик: balance

#### 3.3.4 Другие уведомления
- Создание пользователя: "Создан новый пользователь {login} с ролью {role}"
- Удаление пользователя: "Удалён пользователь {login}"
- Создание поставщика: "Создан новый поставщик {name}"
- Удаление поставщика: "Удалён поставщик {name}"
- Удаление накладной: "Удалена накладная от {supplier} на сумму {amount} ₽"
- Топик: users (для пользователей), payments (для платежей)

## 4. Порядок реализации

1. ✅ Создать loader компонент
2. ✅ Улучшить стили
3. ✅ Создать модель Settings
4. ✅ Создать страницу Settings
5. ✅ Реализовать автоматический ночной режим
6. ✅ Создать модель TelegramConfig
7. ✅ Создать сервис Telegram
8. ✅ Интегрировать уведомления о накладных
9. ✅ Интегрировать уведомления о листе сборки
10. ✅ Интегрировать уведомления о балансе
11. ✅ Добавить остальные уведомления

## 5. Технические детали

### 5.1 Telegram Bot API
- Использовать библиотеку `node-telegram-bot-api` или `axios` для прямых запросов
- Поддержка форматирования сообщений (Markdown/HTML)
- Отправка фото через multipart/form-data

### 5.2 Автоматический ночной режим
- Проверка времени на сервере (МСК)
- Обновление темы через WebSocket или polling
- Сохранение предпочтений пользователя

### 5.3 Настройки дизайна
- Глобальное состояние через Context
- Применение к всем компонентам
- Сохранение в localStorage и на сервере

