# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "JavaScript heap out of memory"

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
```

## –ü—Ä–∏—á–∏–Ω–∞

Node.js –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –æ–∫–æ–ª–æ 1.5-2 GB, –Ω–æ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö TypeScript –ø—Ä–æ–µ–∫—Ç–æ–≤ —ç—Ç–æ–≥–æ –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∏—Ç—å.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π package.json (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–§–∞–π–ª `package.json` —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω. –ü—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /var/www/davidsklad/backend
npm run build
```

–°–∫—Ä–∏–ø—Ç `build` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ (4 GB).

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –µ—â–µ –±–æ–ª—å—à–µ, –∏–∑–º–µ–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ `package.json`:

```json
"build": "node --max-old-space-size=6144 node_modules/typescript/bin/tsc"
```

–ì–¥–µ `6144` - —ç—Ç–æ –ª–∏–º–∏—Ç –≤ MB (6 GB).

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export NODE_OPTIONS="--max-old-space-size=4096"
npm run build
```

–ò–ª–∏ –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ:

```bash
NODE_OPTIONS="--max-old-space-size=4096" npm run build
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –î–ª—è Windows (PowerShell)

```powershell
$env:NODE_OPTIONS="--max-old-space-size=4096"
npm run build
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

- **2 GB (2048)** - –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- **4 GB (4096)** - –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (—Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
- **6 GB (6144)** - –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- **8 GB (8192)** - –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–∞–º—è—Ç—å:

```bash
free -h
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (`full-install.sh`, `deploy.sh`, `update-from-github.sh`) –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `package.json` —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –ª–∏–º–∏—Ç–æ–º –ø–∞–º—è—Ç–∏.

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –º–æ–∂–Ω–æ:

1. **–†–∞–∑–¥–µ–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ –º–æ–¥—É–ª–∏** - –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º
2. **–£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã** - —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å incremental –∫–æ–º–ø–∏–ª—è—Ü–∏—é** - –¥–æ–±–∞–≤–∏—Ç—å –≤ `tsconfig.json`:
   ```json
   {
     "compilerOptions": {
       "incremental": true,
       "tsBuildInfoFile": ".tsbuildinfo"
     }
   }
   ```

---

**–§–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω:** `backend/package.json`

