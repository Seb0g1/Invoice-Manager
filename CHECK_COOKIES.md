# üç™ –ü—Ä–æ–≤–µ—Ä–∫–∞ Cookies –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

## –ü—Ä–æ–±–ª–µ–º–∞: 401 –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

–ï—Å–ª–∏ –≤—ã –≤—Ö–æ–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç–µ 401, –ø—Ä–æ–±–ª–µ–º–∞ –≤ cookies.

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ DevTools

–ù–∞–∂–º–∏—Ç–µ **F12** –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –®–∞–≥ 2: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://david.sakoo.ru/login
2. –í–≤–µ–¥–∏—Ç–µ: `director` / `CGJ-Ge-90`
3. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network

1. **DevTools** ‚Üí **Network**
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `/api/auth/login`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ ‚Üí **Headers**

#### Response Headers (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å):
```
Set-Cookie: token=...; HttpOnly; SameSite=Lax; Path=/; Max-Age=604800
```

–ï—Å–ª–∏ `Set-Cookie` –Ω–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ backend

#### Request Headers (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞):
```
Cookie: token=...
```

–ï—Å–ª–∏ `Cookie` –Ω–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ Nginx

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Application

1. **DevTools** ‚Üí **Application** ‚Üí **Cookies** ‚Üí **http://david.sakoo.ru**
2. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å cookie `token`

–ï—Å–ª–∏ cookie –Ω–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö cookies

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

```bash
pm2 logs invoice-backend --lines 50
```

–ò—â–∏—Ç–µ:
- `Cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:` - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏ –≤—Ö–æ–¥–µ
- `Login error:` - –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env

```bash
cd /var/www/david-warehouse/backend
cat .env | grep -E 'FRONTEND_URL|COOKIE_DOMAIN'
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
FRONTEND_URL=http://david.sakoo.ru
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Nginx

```bash
sudo cat /etc/nginx/sites-available/david-warehouse | grep -A 10 "location /api"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```nginx
location /api {
    proxy_pass http://localhost:5000;
    proxy_set_header Cookie $http_cookie;
    ...
}
```

### 4. –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ curl

```bash
cd /var/www/david-warehouse
./diagnose-auth.sh
```

## –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: Cookies –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cookies –≤ backend

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd /var/www/david-warehouse/backend
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env
cat .env | grep FRONTEND_URL
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: FRONTEND_URL=http://david.sakoo.ru

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend
pm2 restart invoice-backend
```

### –†–µ—à–µ–Ω–∏–µ 2: Cookies –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Nginx

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç cookies

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd /var/www/david-warehouse
sudo cp nginx-david.sakoo.ru.conf /etc/nginx/sites-available/david-warehouse
sudo nginx -t
sudo systemctl reload nginx
```

### –†–µ—à–µ–Ω–∏–µ 3: –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç cookies

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–∫–ª—é—á–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É cookies –¥–ª—è —Å–∞–π—Ç–∞
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä
- –û—á–∏—Å—Ç–∏—Ç–µ cookies –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

### –†–µ—à–µ–Ω–∏–µ 4: –ü–∞—Ä–æ–ª—å –Ω–µ –∏–∑–º–µ–Ω—ë–Ω

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∞—Ä–æ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd /var/www/david-warehouse
./change-director-password.sh
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. ‚úÖ –û—á–∏—Å—Ç–∏—Ç–µ cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. ‚úÖ –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É: `director` / `CGJ-Ge-90`
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cookie `token` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ 401 –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–º

## –í–∞–∂–Ω–æ

- **401 –¥–æ –≤—Ö–æ–¥–∞** = –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚úÖ
- **401 –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞** = –ø—Ä–æ–±–ª–µ–º–∞ —Å cookies ‚ùå
- **Cookie –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** = –ø—Ä–æ–±–ª–µ–º–∞ –≤ backend ‚ùå
- **Cookie —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** = –ø—Ä–æ–±–ª–µ–º–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ/Nginx ‚ùå


