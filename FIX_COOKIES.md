# üç™ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Cookies –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

## –ü—Ä–æ–±–ª–µ–º–∞: 401 –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

–ï—Å–ª–∏ –≤—ã –≤—Ö–æ–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç–µ 401, –ø—Ä–æ–±–ª–µ–º–∞ –≤ cookies.

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
cd /var/www/david-warehouse
git pull origin main
cd backend
npm run build
pm2 restart invoice-backend
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env

```bash
cd /var/www/david-warehouse/backend
nano .env
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
```env
FRONTEND_URL=http://david.sakoo.ru
NODE_ENV=production
```

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç–µ cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. **F12** ‚Üí **Application** ‚Üí **Cookies** ‚Üí **http://david.sakoo.ru**
2. –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ cookies
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (**Ctrl+F5**)

### –®–∞–≥ 4: –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://david.sakoo.ru/login
2. –í–≤–µ–¥–∏—Ç–µ: `director` / `CGJ-Ge-90`
3. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookies

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞:
- **F12** ‚Üí **Application** ‚Üí **Cookies**
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å cookie `token` —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Cookies —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è?

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –Ω–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `/api/auth/login` ‚Üí Headers ‚Üí Response Headers

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
```
Set-Cookie: token=...; HttpOnly; SameSite=Lax; Max-Age=604800
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Cookies –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è?

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –Ω–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `/api/auth/me` ‚Üí Headers ‚Üí Request Headers

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
```
Cookie: token=...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: Backend –ø–æ–ª—É—á–∞–µ—Ç cookies?

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
pm2 logs invoice-backend --lines 50
```

–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Cookies –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cookies –≤ backend.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω (—Å–º. –®–∞–≥ 1)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `FRONTEND_URL=http://david.sakoo.ru` –≤ `.env`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Cookies –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–∫–ª—é—á–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É cookies –¥–ª—è —Å–∞–π—Ç–∞
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 3: SameSite cookie errors

**–ü—Ä–∏—á–∏–Ω–∞:** –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç cookies –∏–∑-–∑–∞ SameSite.

**–†–µ—à–µ–Ω–∏–µ:**
- –ö–æ–¥ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (SameSite: 'lax' –¥–ª—è HTTP)
- –û–±–Ω–æ–≤–∏—Ç–µ backend (—Å–º. –®–∞–≥ 1)

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Cookies –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Nginx

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç cookies –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```nginx
location /api {
    proxy_pass http://localhost:5000;
    proxy_set_header Cookie $http_cookie;
    proxy_set_header Host $host;
    ...
}
```

## –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç)

```bash
cd /var/www/david-warehouse

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backend
pm2 delete invoice-backend

# –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
cd backend
rm -rf node_modules dist
npm install
npm run build

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
cd ..
chmod +x setup-pm2.sh
./setup-pm2.sh
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. ‚úÖ –û—á–∏—Å—Ç–∏—Ç–µ cookies
2. ‚úÖ –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cookie `token` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ 401 –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–º

## –í–∞–∂–Ω–æ

- **401 –¥–æ –≤—Ö–æ–¥–∞** = –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚úÖ
- **401 –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞** = –ø—Ä–æ–±–ª–µ–º–∞ —Å cookies ‚ùå
- **Cookie –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** = –ø—Ä–æ–±–ª–µ–º–∞ –≤ backend ‚ùå
- **Cookie —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** = –ø—Ä–æ–±–ª–µ–º–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ/Nginx ‚ùå

