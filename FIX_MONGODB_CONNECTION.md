# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB

## –ü—Ä–æ–±–ª–µ–º–∞

```
MongooseServerSelectionError: connect ECONNREFUSED ::1:27017
```

–û—à–∏–±–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB –Ω–∞ `localhost:27017`.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ MongoDB

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω –ª–∏ MongoDB
sudo systemctl status mongod
```

–ï—Å–ª–∏ MongoDB –Ω–µ –∑–∞–ø—É—â–µ–Ω, –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
‚óè mongod.service - MongoDB Database Server
   Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)
   Active: inactive (dead)
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ MongoDB

```bash
# –ó–∞–ø—É—Å–∫ MongoDB
sudo systemctl start mongod

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
sudo systemctl enable mongod

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status mongod
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚óè mongod.service - MongoDB Database Server
   Active: active (running)
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–ª—É—à–∞–µ—Ç –ª–∏ MongoDB –Ω–∞ –ø–æ—Ä—Ç—É 27017
sudo netstat -tlnp | grep 27017
# –∏–ª–∏
sudo ss -tlnp | grep 27017
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
```
tcp  0  0  127.0.0.1:27017  0.0.0.0:*  LISTEN  12345/mongod
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ MongoDB

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
sudo cat /etc/mongod.conf | grep -A 5 "net:"
```

–í–∞–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `bindIp`. –û–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
```yaml
net:
  port: 27017
  bindIp: 127.0.0.1  # –∏–ª–∏ 0.0.0.0 –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
```

## üîß –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 127.0.0.1 –≤–º–µ—Å—Ç–æ localhost

–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–æ–º, —á—Ç–æ `localhost` —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –≤ IPv6 (`::1`), –∞ MongoDB —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ IPv4 (`127.0.0.1`).

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ `.env` —Ñ–∞–π–ª–µ:**

```bash
cd /var/www/davidsklad/backend
nano .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```env
# –ë—ã–ª–æ:
MONGO_URI=mongodb://localhost:27017/invoice-db

# –°—Ç–∞–ª–æ:
MONGO_URI=mongodb://127.0.0.1:27017/invoice-db
```

### –†–µ—à–µ–Ω–∏–µ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã MongoDB —Å–ª—É—à–∞–ª –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (–≤–∫–ª—é—á–∞—è IPv6):

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nano /etc/mongod.conf
```

–ò–∑–º–µ–Ω–∏—Ç–µ —Å–µ–∫—Ü–∏—é `net`:
```yaml
net:
  port: 27017
  bindIp: 0.0.0.0  # –∏–ª–∏ 127.0.0.1,::1 –¥–ª—è IPv4 –∏ IPv6
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ MongoDB:
```bash
sudo systemctl restart mongod
```

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª —Ñ–∞–π—Ä–≤–æ–ª–∞
sudo ufw status

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è localhost)
sudo ufw allow 27017/tcp
```

### –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ MongoDB

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ MongoDB
sudo journalctl -u mongod -n 50 --no-pager

# –ò–ª–∏
sudo tail -f /var/log/mongodb/mongod.log
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ mongo shell
mongosh "mongodb://127.0.0.1:27017/invoice-db"

# –ò–ª–∏ —á–µ—Ä–µ–∑ telnet
telnet 127.0.0.1 27017
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `.env` —Ñ–∞–π–ª–∞:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2 –ø—Ä–æ—Ü–µ—Å—Å–∞
pm2 restart davidsklad-backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
pm2 logs davidsklad-backend
```

## üìã –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ MongoDB
sudo systemctl status mongod

# 2. –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω - –∑–∞–ø—É—Å–∫
sudo systemctl start mongod
sudo systemctl enable mongod

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
sudo netstat -tlnp | grep 27017

# 4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cd /var/www/davidsklad/backend
nano .env
# –ò–∑–º–µ–Ω–∏—Ç–µ MONGO_URI –Ω–∞ mongodb://127.0.0.1:27017/invoice-db

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 restart davidsklad-backend

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
pm2 logs davidsklad-backend --lines 50
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ MongoDB —Å–ª—É—à–∞–µ—Ç –Ω–∞ `0.0.0.0`, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
2. –§–∞–π—Ä–≤–æ–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É 27017
3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSL/TLS –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- `bindIp: 127.0.0.1` (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø)
- `MONGO_URI=mongodb://127.0.0.1:27017/invoice-db`

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. **–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB:**
   ```bash
   sudo systemctl stop mongod
   sudo apt remove mongodb-org
   sudo apt autoremove
   # –ó–∞—Ç–µ–º —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏–∑ MONGODB_LOCAL_SETUP.md
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:**
   ```bash
   sudo chown -R mongodb:mongodb /var/lib/mongodb
   sudo chown -R mongodb:mongodb /var/log/mongodb
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ:**
   ```bash
   df -h
   ```

---

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB! ‚úÖ

